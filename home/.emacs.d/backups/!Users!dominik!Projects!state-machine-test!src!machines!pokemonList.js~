import { call } from 'stent/lib/helpers';
import { getSpecies } from 'src/api';

export default {
  state: { name: 'idle', data: [], page: 0, error: false },
  transitions: {
    idle: {
      fetch: function* (state, options) {
        yield 'loading';

        try {
          const data = yield call(getSpecies, state.page);
          yield this.success([...state.data, ...data], state.page + 1);
        } catch (e) {
          yield this.error();
        }
      },
    },
    loading: {
      error: (state) => ({
        name: 'idle',
        error: true,
      }),
      success: (state, data, page) => ({
        name: 'idle',
        data,
        page,
      }),
    },
  },
};
